name: 'Clean Github Actions Runner'
description: 'Remove unneeded packages and clean up disk space on the Github Actions runner'

runs:
  using: 'composite'
  steps:
    - name: Get current disk usage
      shell: bash
      run: |
        echo "Getting disk free space"
        df -h

        echo "Getting /usr/share disk usage"
        du -shc /usr/share/* | sort -hr | head -n 10

        echo "Getting /usr/local/share disk usage"
        du -shc /usr/local/share/* | sort -hr | head -n 10

        echo "Getting /usr/local/lib disk usage"
        du -shc /usr/local/lib/* | sort -hr | head -n 10

        echo "Getting tool cache disk usage"
        du -shc "$AGENT_TOOLSDIRECTORY"/* | sort -hr | head -n 10

    - name: Clean unneeded packages
      shell: bash
      run: |
        echo "Removing unneeded packages"
        sudo rm -rf /usr/share/dotnet/
        sudo rm -rf /usr/local/share/powershell
        sudo rm -rf /usr/local/share/chromium

    - name: Print final disk usage
      shell: bash
      run: |
        echo "Getting final disk free space"
        df -h